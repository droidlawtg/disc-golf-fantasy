<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rick is #1 Fantasy League</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e14;
    --surface: #111620;
    --surface2: #181e2c;
    --surface3: #1f2638;
    --border: #ffffff0f;
    --border2: #ffffff1a;
    --accent: #c8f500;
    --accent2: #00d4ff;
    --rick: #3b82f6;
    --joe: #f43f5e;
    --rory: #22c55e;
    --text: #eef2ff;
    --muted: #5a6380;
    --gold: #fbbf24;
    --chains: #ffffff08;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Barlow', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Chains background pattern */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(circle at 15% 15%, #3b82f614 0%, transparent 40%),
      radial-gradient(circle at 85% 85%, #c8f50008 0%, transparent 40%),
      repeating-linear-gradient(0deg, transparent, transparent 40px, var(--chains) 40px, var(--chains) 41px),
      repeating-linear-gradient(90deg, transparent, transparent 40px, var(--chains) 40px, var(--chains) 41px);
    pointer-events: none;
    z-index: 0;
  }

  /* Disc watermark */
  body::after {
    content: '';
    position: fixed;
    bottom: -100px;
    right: -100px;
    width: 500px;
    height: 500px;
    border-radius: 50%;
    border: 40px solid #ffffff04;
    box-shadow: inset 0 0 0 80px #ffffff02, inset 0 0 0 120px #ffffff01;
    pointer-events: none;
    z-index: 0;
  }

  /* ---- HEADER ---- */
  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: #0a0e14f0;
    backdrop-filter: blur(24px);
    border-bottom: 1px solid var(--border2);
    padding: 0 2rem;
    height: 68px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.45rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  /* Animated disc logo */
  .disc-logo {
    position: relative;
    width: 36px;
    height: 36px;
    flex-shrink: 0;
  }

  .disc-outer {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: conic-gradient(var(--accent) 0deg, #8ab800 120deg, #5a7a00 240deg, var(--accent) 360deg);
    animation: spin-slow 8s linear infinite;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 16px var(--accent)40;
  }

  .disc-inner {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--bg);
    border: 2px solid var(--accent)80;
  }

  @keyframes spin-slow { to { transform: rotate(360deg); } }

  .logo-text { line-height: 1; }
  .logo-text span { color: var(--accent); }
  .logo-sub {
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--muted);
    display: block;
    margin-top: 1px;
  }

  nav {
    display: flex;
    gap: 2px;
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 10px;
    padding: 4px;
  }

  nav button {
    background: transparent;
    border: none;
    color: var(--muted);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.45rem 1rem;
    border-radius: 7px;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  nav button:hover { color: var(--text); background: var(--surface2); }
  nav button.active { color: #000; background: var(--accent); }

  /* ---- MAIN ---- */
  main {
    position: relative;
    z-index: 1;
    max-width: 1140px;
    margin: 0 auto;
    padding: 2.5rem 2rem;
  }

  .page { display: none; animation: pageIn 0.3s ease; }
  .page.active { display: block; }

  @keyframes pageIn {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ---- SECTION TITLE ---- */
  .section-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 2.6rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    line-height: 1;
    margin-bottom: 1.75rem;
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
  }

  .section-title span { color: var(--accent); }
  .section-title small {
    font-size: 0.75rem;
    color: var(--muted);
    letter-spacing: 0.15em;
    font-weight: 600;
  }

  /* ---- STANDINGS ---- */
  .standings-grid { display: grid; gap: 1rem; }

  .team-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 16px;
    padding: 1.75rem 2rem;
    display: flex;
    align-items: center;
    gap: 2rem;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    animation: cardIn 0.5s ease both;
  }

  .team-card:nth-child(1) { animation-delay: 0.05s; }
  .team-card:nth-child(2) { animation-delay: 0.1s; }
  .team-card:nth-child(3) { animation-delay: 0.15s; }

  @keyframes cardIn {
    from { opacity: 0; transform: translateX(-16px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  .team-card:hover { transform: translateY(-2px); box-shadow: 0 12px 40px #00000040; }

  .team-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 5px;
  }

  .team-card.rick::before { background: linear-gradient(180deg, #60a5fa, var(--rick)); }
  .team-card.joe::before  { background: linear-gradient(180deg, #fb7185, var(--joe)); }
  .team-card.rory::before { background: linear-gradient(180deg, #4ade80, var(--rory)); }

  .team-card.first {
    border-color: var(--gold)40;
    background: linear-gradient(135deg, #1a1700 0%, var(--surface) 60%);
    box-shadow: 0 0 40px var(--gold)08;
  }

  .team-rank {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 3rem;
    color: var(--muted);
    min-width: 60px;
    text-align: center;
    line-height: 1;
  }

  .team-card.first .team-rank { color: var(--gold); text-shadow: 0 0 20px var(--gold)60; }

  .team-info { flex: 1; }

  .team-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.2rem;
  }

  .team-card.rick .team-name { color: #93c5fd; }
  .team-card.joe  .team-name { color: #fda4af; }
  .team-card.rory .team-name { color: #86efac; }

  .team-meta { font-size: 0.75rem; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }

  .team-pts-wrap { text-align: right; }

  .team-points {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 3.5rem;
    line-height: 1;
  }

  .team-pts-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.15em; }

  /* ---- TABLES ---- */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--surface);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border2);
  }

  .data-table thead tr { background: var(--surface3); }

  .data-table th {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--muted);
    padding: 1rem 1.25rem;
    text-align: left;
  }

  .data-table th.center, .data-table td.center { text-align: center; }

  .data-table td {
    padding: 0.85rem 1.25rem;
    border-top: 1px solid var(--border);
    font-size: 0.92rem;
  }

  .data-table tbody tr { transition: background 0.15s; }
  .data-table tbody tr:hover { background: var(--surface2); }

  .rank-pill {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    background: var(--surface3);
  }

  .rank-pill.r1 { background: var(--gold); color: #000; box-shadow: 0 0 12px var(--gold)60; }
  .rank-pill.r2 { background: #9ca3af; color: #000; }
  .rank-pill.r3 { background: #b45309; color: #fff; }

  .team-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 8px;
    flex-shrink: 0;
  }

  .dot-rick { background: var(--rick); box-shadow: 0 0 6px var(--rick)80; }
  .dot-joe  { background: var(--joe);  box-shadow: 0 0 6px var(--joe)80; }
  .dot-rory { background: var(--rory); box-shadow: 0 0 6px var(--rory)80; }

  .div-pill {
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    padding: 2px 8px;
    border-radius: 20px;
    text-transform: uppercase;
  }

  .div-mpo { background: #3b82f618; color: #93c5fd; border: 1px solid #3b82f630; }
  .div-fpo { background: #f43f5e18; color: #fda4af; border: 1px solid #f43f5e30; }

  /* ---- RESULTS ---- */
  .results-grid { display: grid; gap: 1.25rem; }

  .result-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 16px;
    overflow: hidden;
  }

  .result-header {
    padding: 1.1rem 1.5rem;
    background: var(--surface2);
    border-bottom: 1px solid var(--border2);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .result-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1.15rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }

  .result-meta { display: flex; align-items: center; gap: 0.6rem; }

  .type-badge {
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    padding: 3px 10px;
    border-radius: 20px;
    text-transform: uppercase;
  }

  .type-major     { background: var(--gold)20; color: var(--gold); border: 1px solid var(--gold)40; }
  .type-eliteplus { background: var(--accent2)15; color: var(--accent2); border: 1px solid var(--accent2)30; }
  .type-regular   { background: var(--surface3); color: var(--muted); border: 1px solid var(--border2); }

  .mult-tag {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    color: var(--muted);
  }

  .result-body { display: grid; grid-template-columns: 1fr 1fr; }

  .div-col { padding: 1.1rem 1.5rem; }
  .div-col:first-child { border-right: 1px solid var(--border); }

  .div-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.7rem;
  }

  .result-row {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.3rem 0;
    font-size: 0.88rem;
  }

  .result-place {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    min-width: 24px;
    color: var(--muted);
  }

  .result-place.p1 { color: var(--gold); }
  .result-place.p2 { color: #9ca3af; }
  .result-place.p3 { color: #cd7c2a; }

  .result-player.drafted { font-weight: 600; }
  .result-pts { font-family: 'Barlow Condensed', sans-serif; font-weight: 700; color: var(--accent); margin-left: auto; }

  /* ---- ROSTER ---- */
  .roster-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }

  .roster-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 16px;
    overflow: hidden;
  }

  .roster-head {
    padding: 1.2rem 1.5rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.35rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    border-bottom: 1px solid var(--border2);
  }

  .roster-head.rick { background: linear-gradient(135deg, #1a2e50, var(--surface2)); color: #93c5fd; }
  .roster-head.joe  { background: linear-gradient(135deg, #501a24, var(--surface2)); color: #fda4af; }
  .roster-head.rory { background: linear-gradient(135deg, #1a4028, var(--surface2)); color: #86efac; }

  .div-section-label {
    padding: 0.5rem 1.5rem 0.3rem;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    background: var(--surface2);
    border-top: 1px solid var(--border);
  }

  .roster-player {
    padding: 0.7rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-top: 1px solid var(--border);
    font-size: 0.88rem;
    transition: background 0.15s;
  }

  .roster-player:hover { background: var(--surface2); }

  /* ---- WAIVER WIRE ---- */
  .waiver-layout {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 1.5rem;
    align-items: start;
  }

  .waiver-tabs {
    display: flex;
    gap: 4px;
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 10px;
    padding: 4px;
    margin-bottom: 1.25rem;
    width: fit-content;
  }

  .waiver-tab {
    background: transparent;
    border: none;
    color: var(--muted);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.4rem 1.2rem;
    border-radius: 7px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .waiver-tab:hover { color: var(--text); background: var(--surface2); }
  .waiver-tab.active { color: #000; background: var(--accent); }

  .waiver-table-wrap { overflow: hidden; border-radius: 16px; border: 1px solid var(--border2); }

  .add-btn {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 6px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.78rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 5px 12px;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }

  .add-btn:hover { opacity: 0.8; }

  /* ---- TRANSACTION PANEL ---- */
  .txn-panel {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 16px;
    overflow: hidden;
    position: sticky;
    top: 84px;
  }

  .txn-header {
    padding: 1.1rem 1.5rem;
    background: var(--surface2);
    border-bottom: 1px solid var(--border2);
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .txn-body { padding: 1.25rem; }

  .txn-step { margin-bottom: 1.25rem; }

  .txn-label {
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.5rem;
  }

  .txn-select {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    font-size: 0.88rem;
    padding: 0.65rem 0.9rem;
    outline: none;
    cursor: pointer;
    transition: border-color 0.2s;
    appearance: none;
  }

  .txn-select:focus { border-color: var(--accent)60; }

  .selected-add {
    background: var(--accent)15;
    border: 1px solid var(--accent)30;
    border-radius: 8px;
    padding: 0.65rem 0.9rem;
    font-size: 0.88rem;
    color: var(--accent);
    font-weight: 600;
    min-height: 40px;
  }

  .cost-badge {
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 0.65rem 0.9rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.88rem;
  }

  .cost-number {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.5rem;
    color: var(--joe);
  }

  .confirm-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--accent), #8ab800);
    color: #000;
    border: none;
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.85rem;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 1rem;
  }

  .confirm-btn:hover { opacity: 0.9; }
  .confirm-btn:active { transform: scale(0.98); }
  .confirm-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .txn-log {
    border-top: 1px solid var(--border2);
    padding: 1rem 1.25rem;
    max-height: 200px;
    overflow-y: auto;
  }

  .txn-log-title {
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 0.75rem;
  }

  .txn-entry {
    font-size: 0.78rem;
    color: var(--muted);
    padding: 0.35rem 0;
    border-bottom: 1px solid var(--border);
    line-height: 1.5;
  }

  .txn-entry:last-child { border-bottom: none; }
  .txn-entry .in  { color: var(--rory); font-weight: 600; }
  .txn-entry .out { color: var(--joe); font-weight: 600; }
  .txn-entry .cost-tag { color: var(--gold); }

  /* ---- MODAL ---- */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: #00000090;
    backdrop-filter: blur(8px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 20px;
    padding: 2rem;
    max-width: 420px;
    width: 90%;
    animation: modalIn 0.25s ease;
  }

  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.9) translateY(20px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal h3 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.4rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    margin-bottom: 1rem;
  }

  .modal-detail {
    background: var(--surface2);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
    font-size: 0.88rem;
    line-height: 1.8;
  }

  .modal-detail strong { color: var(--accent); }
  .modal-detail .warn  { color: var(--gold); font-weight: 600; }

  .modal-actions { display: flex; gap: 0.75rem; }

  .modal-cancel {
    flex: 1;
    background: var(--surface2);
    border: 1px solid var(--border2);
    color: var(--text);
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 0.75rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .modal-cancel:hover { background: var(--surface3); }

  .modal-confirm {
    flex: 2;
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 0.95rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 0.75rem;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .modal-confirm:hover { opacity: 0.85; }

  /* ---- SETUP ---- */
  .setup-card {
    background: var(--surface);
    border: 1px solid var(--accent)30;
    border-radius: 16px;
    padding: 2rem;
    max-width: 600px;
  }

  .setup-card h3 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1.15rem;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
  }

  .setup-card p { font-size: 0.88rem; color: var(--muted); margin-bottom: 0.75rem; line-height: 1.6; }
  .setup-card code { background: var(--surface2); border: 1px solid var(--border2); border-radius: 4px; padding: 0.1em 0.4em; font-size: 0.82rem; color: var(--accent2); }

  .setup-input {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Barlow', sans-serif;
    font-size: 0.9rem;
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .setup-input:focus { border-color: var(--accent)60; }

  .setup-btn {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 8px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 0.75rem 2rem;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .setup-btn:hover { opacity: 0.85; }

  /* ---- LOADING / ERRORS ---- */
  .loading {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--muted);
  }

  .spin-disc {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 3px solid var(--border2);
    border-top-color: var(--accent);
    animation: spin 0.7s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .empty-msg {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    color: var(--muted);
    font-size: 0.9rem;
  }

  /* ---- RESPONSIVE ---- */
  @media (max-width: 900px) {
    .waiver-layout { grid-template-columns: 1fr; }
    .roster-grid   { grid-template-columns: 1fr; }
    .result-body   { grid-template-columns: 1fr; }
    .div-col:first-child { border-right: none; border-bottom: 1px solid var(--border); }
    .section-title { font-size: 2rem; }
    nav { gap: 1px; }
    nav button { padding: 0.4rem 0.65rem; font-size: 0.78rem; }
    .logo-text { font-size: 1.1rem; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="disc-logo">
      <div class="disc-outer"><div class="disc-inner"></div></div>
    </div>
    <div class="logo-text">
      Rick is <span>#1</span> Fantasy
      <span class="logo-sub">2026 Season Â· PDGA Elite Series</span>
    </div>
  </div>
  <nav>
    <button class="active" onclick="showPage('standings',this)">Standings</button>
    <button onclick="showPage('players',this)">Players</button>
    <button onclick="showPage('results',this)">Results</button>
    <button onclick="showPage('roster',this)">Roster</button>
    <button onclick="showPage('waiver',this)">ðŸ”„ Wire</button>
    <button onclick="showPage('setup',this)">âš™</button>
  </nav>
</header>

<main>

  <!-- STANDINGS -->
  <div id="page-standings" class="page active">
    <div class="section-title">League <span>Standings</span> <small>2026</small></div>
    <div id="standings-content" class="standings-grid">
      <div class="loading"><div class="spin-disc"></div>Loading...</div>
    </div>
  </div>

  <!-- PLAYERS -->
  <div id="page-players" class="page">
    <div class="section-title">Player <span>Stats</span></div>
    <div id="players-content">
      <div class="loading"><div class="spin-disc"></div>Loading...</div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="page-results" class="page">
    <div class="section-title">Tournament <span>Results</span></div>
    <div id="results-content" class="results-grid">
      <div class="loading"><div class="spin-disc"></div>Loading...</div>
    </div>
  </div>

  <!-- ROSTER -->
  <div id="page-roster" class="page">
    <div class="section-title">Team <span>Rosters</span></div>
    <div id="roster-content" class="roster-grid"></div>
  </div>

  <!-- WAIVER WIRE -->
  <div id="page-waiver" class="page">
    <div class="section-title">Waiver <span>Wire</span></div>
    <div class="waiver-layout">

      <!-- Available Players -->
      <div>
        <div class="waiver-tabs">
          <button class="waiver-tab active" onclick="showWaiverDiv('MPO',this)">MPO Top 50</button>
          <button class="waiver-tab" onclick="showWaiverDiv('FPO',this)">FPO Top 30</button>
        </div>
        <div class="waiver-table-wrap">
          <table class="data-table" id="waiver-table">
            <thead>
              <tr>
                <th class="center">Rank</th>
                <th>Player</th>
                <th class="center">Status</th>
                <th class="center">Action</th>
              </tr>
            </thead>
            <tbody id="waiver-tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- Transaction Panel -->
      <div class="txn-panel">
        <div class="txn-header">Make a Transaction</div>
        <div class="txn-body">

          <div class="txn-step">
            <div class="txn-label">1. Select Your Team</div>
            <select class="txn-select" id="txn-team" onchange="updateTxnPanel()">
              <option value="">â€” Choose team â€”</option>
              <option value="Team Rick">Team Rick</option>
              <option value="Team Joe">Team Joe</option>
              <option value="Team Rory">Team Rory</option>
            </select>
          </div>

          <div class="txn-step">
            <div class="txn-label">2. Player to Add</div>
            <div class="selected-add" id="txn-add-display">Click "Add" next to a player â†’</div>
          </div>

          <div class="txn-step">
            <div class="txn-label">3. Player to Drop</div>
            <select class="txn-select" id="txn-drop" onchange="updateTxnPanel()">
              <option value="">â€” Select player to drop â€”</option>
            </select>
          </div>

          <div class="txn-step">
            <div class="txn-label">Transaction Cost</div>
            <div class="cost-badge">
              <span id="txn-cost-label">Select team first</span>
              <span class="cost-number" id="txn-cost-pts">â€”</span>
            </div>
          </div>

          <button class="confirm-btn" id="txn-confirm-btn" onclick="openConfirmModal()" disabled>
            Confirm Transaction
          </button>
        </div>

        <div class="txn-log">
          <div class="txn-log-title">Transaction Log</div>
          <div id="txn-log-list"></div>
        </div>
      </div>

    </div>
  </div>

  <!-- SETUP -->
  <div id="page-setup" class="page">
    <div class="section-title">âš™ <span>Setup</span></div>
    <div class="setup-card">
      <h3>Connect Google Sheet</h3>
      <p>This site reads live data from your Google Sheet. First, publish your sheet: <code>File â†’ Share â†’ Publish to web â†’ Publish</code></p>
      <p>Then grab your Sheet ID from the URL: <code>docs.google.com/spreadsheets/d/<strong>YOUR_ID_HERE</strong>/edit</code></p>
      <input class="setup-input" type="text" id="sheet-id-input" placeholder="Paste Sheet ID here..." />
      <button class="setup-btn" onclick="saveSheetId()">Save & Connect</button>
      <p id="setup-status" style="margin-top:0.75rem; color: var(--accent);"></p>
    </div>
  </div>

</main>

<!-- Confirm Modal -->
<div class="modal-overlay" id="confirm-modal">
  <div class="modal">
    <h3>âš  Confirm Transaction</h3>
    <div class="modal-detail" id="modal-detail-text"></div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeModal()">Cancel</button>
      <button class="modal-confirm" onclick="executeTransaction()">Confirm & Deduct Points</button>
    </div>
  </div>
</div>

<script>
// ============================================================
//  DATA
// ============================================================

const TEAM_META = {
  "Team Rick": { cls: "rick" },
  "Team Joe":  { cls: "joe"  },
  "Team Rory": { cls: "rory" }
};

// Current rosters (updated by transactions)
let ROSTERS = {
  "Team Rick": [
    { name: "Gannon Buhr",     division: "MPO" },
    { name: "Niklas Anttila",  division: "MPO" },
    { name: "Luke Taylor",     division: "MPO" },
    { name: "Lauri Lehtinen",  division: "MPO" },
    { name: "Simon Lizotte",   division: "MPO" },
    { name: "Holyn Handley",   division: "FPO" },
    { name: "Kat Mertsch",     division: "FPO" },
    { name: "Henna Blomroos",  division: "FPO" }
  ],
  "Team Joe": [
    { name: "Calvin Heimburg", division: "MPO" },
    { name: "Isaac Robinson",  division: "MPO" },
    { name: "Aaron Gossage",   division: "MPO" },
    { name: "Eagle McMahon",   division: "MPO" },
    { name: "Silas Schultz",   division: "MPO" },
    { name: "Eveliina Salonen",division: "FPO" },
    { name: "Paige Pierce",    division: "FPO" },
    { name: "Missy Gannon",    division: "FPO" }
  ],
  "Team Rory": [
    { name: "Anthony Barela",  division: "MPO" },
    { name: "Paul McBeth",     division: "MPO" },
    { name: "Ezra Aderhold",   division: "MPO" },
    { name: "Mauri Villmann",  division: "MPO" },
    { name: "Matthew Orum",    division: "MPO" },
    { name: "Silva Saarinen",  division: "FPO" },
    { name: "Cadence Burge",   division: "FPO" },
    { name: "Anniken Kristiansen Steen", division: "FPO" }
  ]
};

// Statmando Official MPO Rankings (top 50, Feb 2026) - drafted players excluded from waiver wire
const MPO_RANKINGS = [
  { rank:1,  name:"Gannon Buhr" },
  { rank:2,  name:"Paul McBeth" },
  { rank:3,  name:"Calvin Heimburg" },
  { rank:4,  name:"Anthony Barela" },
  { rank:5,  name:"Isaac Robinson" },
  { rank:6,  name:"Richard Wysocki" },
  { rank:7,  name:"Niklas Anttila" },
  { rank:8,  name:"Kyle Klein" },
  { rank:9,  name:"Ezra Robinson" },
  { rank:10, name:"Cole Redalen" },
  { rank:11, name:"Adam Hammes" },
  { rank:12, name:"Aaron Gossage" },
  { rank:13, name:"Ezra Aderhold" },
  { rank:14, name:"Simon Lizotte" },
  { rank:15, name:"Andrew Marwede" },
  { rank:16, name:"Mauri Villmann" },
  { rank:17, name:"Evan Smith" },
  { rank:18, name:"Luke Taylor" },
  { rank:19, name:"Sullivan Tipton" },
  { rank:20, name:"Chris Dickerson" },
  { rank:21, name:"Corey Ellis" },
  { rank:22, name:"Lauri Lehtinen" },
  { rank:23, name:"Austin Turner" },
  { rank:24, name:"Gavin Babcock" },
  { rank:25, name:"Joseph Anderson" },
  { rank:26, name:"Paul Krans" },
  { rank:27, name:"Matthew Orum" },
  { rank:28, name:"Eagle McMahon" },
  { rank:29, name:"Benjamin Callaway" },
  { rank:30, name:"Silas Schultz" },
  { rank:31, name:"Bradley Williams" },
  { rank:32, name:"Evan Scott" },
  { rank:33, name:"Casey White" },
  { rank:34, name:"Andrew Presnell" },
  { rank:35, name:"Mason Ford" },
  { rank:36, name:"James Proctor" },
  { rank:37, name:"Daniel Davidsson" },
  { rank:38, name:"VÃ¤inÃ¶ MÃ¤kelÃ¤" },
  { rank:39, name:"Parker Welck" },
  { rank:40, name:"Zachary Nash" },
  { rank:41, name:"Jakub SemerÃ¡d" },
  { rank:42, name:"Jake Monn" },
  { rank:43, name:"Joel Freeman" },
  { rank:44, name:"Paul Ulibarri" },
  { rank:45, name:"Noah Meintsma" },
  { rank:46, name:"Nathan Queen" },
  { rank:47, name:"Jaden Rye" },
  { rank:48, name:"Jesse Nieminen" },
  { rank:49, name:"Harry Chace" },
  { rank:50, name:"Cale Leiviska" }
];

// FPO Top 30 (Statmando/PDGA Official Rankings Feb 2026)
const FPO_RANKINGS = [
  { rank:1,  name:"Kristin LÃ¤tt" },
  { rank:2,  name:"Silva Saarinen" },
  { rank:3,  name:"Missy Gannon" },
  { rank:4,  name:"Holyn Handley" },
  { rank:5,  name:"Eveliina Salonen" },
  { rank:6,  name:"Henna Blomroos" },
  { rank:7,  name:"Paige Pierce" },
  { rank:8,  name:"Kat Mertsch" },
  { rank:9,  name:"Corinne Grzeskowiak" },
  { rank:10, name:"Catrina Allen" },
  { rank:11, name:"Ohn Scoggins" },
  { rank:12, name:"Ella Hansen" },
  { rank:13, name:"Jennifer Allen" },
  { rank:14, name:"Vanessa Van Dyken" },
  { rank:15, name:"Heather Young" },
  { rank:16, name:"Macie Velediaz" },
  { rank:17, name:"Hailey King" },
  { rank:18, name:"Juliana Korver" },
  { rank:19, name:"Sarah Hokom" },
  { rank:20, name:"Kona Star Panis" },
  { rank:21, name:"Kate GeÐ´ÐµÑ€Ð¶" },
  { rank:22, name:"Lisa Fajkus" },
  { rank:23, name:"Paige Shue" },
  { rank:24, name:"Wesskamp Alexis" },
  { rank:25, name:"Lykke Lorentzen" },
  { rank:26, name:"Anniken Kristiansen Steen" },
  { rank:27, name:"Cadence Burge" },
  { rank:28, name:"Jessie Grapenthien" },
  { rank:29, name:"Elaine King" },
  { rank:30, name:"Rebecca Cox" }
];

// ============================================================
//  STATE
// ============================================================

let SHEET_ID = localStorage.getItem('dg_sheet_id') || '';
let pendingAdd = null;
let currentWaiverDiv = 'MPO';

// Load saved roster state and transaction log
function loadState() {
  const savedRosters = localStorage.getItem('dg_rosters');
  if (savedRosters) {
    try { ROSTERS = JSON.parse(savedRosters); } catch(e) {}
  }
}

function saveRosters() {
  localStorage.setItem('dg_rosters', JSON.stringify(ROSTERS));
}

function getTransactionLog() {
  try { return JSON.parse(localStorage.getItem('dg_txn_log') || '[]'); } catch(e) { return []; }
}

function saveTransactionLog(log) {
  localStorage.setItem('dg_txn_log', JSON.stringify(log));
}

function getTeamTxnCount(team) {
  const log = getTransactionLog();
  return log.filter(t => t.team === team).length;
}

function getTransactionCost(team) {
  const count = getTeamTxnCount(team);
  return (count + 1) * 10;
}

// ============================================================
//  NAVIGATION
// ============================================================

function showPage(page, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  if (btn) btn.classList.add('active');
  if (page === 'waiver') renderWaiver();
  if (page === 'roster') renderRoster();
}

// ============================================================
//  GOOGLE SHEETS
// ============================================================

function sheetUrl(name) {
  return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(name)}`;
}

async function fetchSheet(name) {
  const res  = await fetch(sheetUrl(name));
  const text = await res.text();
  const json = JSON.parse(text.substring(47).slice(0,-2));
  const cols = json.table.cols.map(c => c.label);
  return json.table.rows
    .filter(r => r)
    .map(row => row.c.reduce((obj, cell, i) => {
      obj[cols[i]] = cell ? cell.v : null;
      return obj;
    }, {}));
}

function saveSheetId() {
  const val = document.getElementById('sheet-id-input').value.trim();
  if (!val) return;
  SHEET_ID = val;
  localStorage.setItem('dg_sheet_id', val);
  document.getElementById('setup-status').textContent = 'âœ… Connected! Loading data...';
  loadSheetData();
}

async function loadSheetData() {
  if (!SHEET_ID) { showNoSheet(); return; }
  try {
    const [standings, players, results] = await Promise.all([
      fetchSheet('Standings').catch(() => null),
      fetchSheet('Player Stats').catch(() => null),
      fetchSheet('Results').catch(() => null)
    ]);
    renderStandings(standings);
    renderPlayers(players);
    renderResults(results);
  } catch(e) {
    console.error(e);
    showError('Could not load data. Make sure the sheet is published publicly and the ID is correct. Go to âš™ Setup.');
  }
}

function showNoSheet() {
  const msg = `<div class="empty-msg">No Google Sheet connected yet.<br>Go to <strong>âš™ Setup</strong> to connect your sheet.</div>`;
  ['standings-content','players-content','results-content'].forEach(id => {
    document.getElementById(id).innerHTML = msg;
  });
}

function showError(msg) {
  const html = `<div class="empty-msg">${msg}</div>`;
  ['standings-content','players-content','results-content'].forEach(id => {
    document.getElementById(id).innerHTML = html;
  });
}

// ============================================================
//  RENDER STANDINGS
// ============================================================

function renderStandings(data) {
  const el = document.getElementById('standings-content');
  if (!data || !data.length) {
    el.innerHTML = `<div class="empty-msg">No standings yet. Results will appear after the first tournament completes!</div>`;
    return;
  }

  // Include transaction deductions
  const log = getTransactionLog();
  const deductions = {};
  log.forEach(t => { deductions[t.team] = (deductions[t.team] || 0) + t.cost; });

  const rows = data.filter(r => r['Team'] && r['Total Points'] !== null);
  rows.sort((a,b) => {
    const ap = (a['Total Points'] || 0) - (deductions[a['Team']] || 0);
    const bp = (b['Total Points'] || 0) - (deductions[b['Team']] || 0);
    return bp - ap;
  });

  const medals = ['ðŸ†','ðŸ¥ˆ','ðŸ¥‰'];
  el.innerHTML = rows.map((row, i) => {
    const team = row['Team'] || '';
    const base = row['Total Points'] || 0;
    const ded  = deductions[team] || 0;
    const pts  = base - ded;
    const tc   = TEAM_META[team] || { cls:'rick' };

    return `
      <div class="team-card ${tc.cls} ${i===0?'first':''}">
        <div class="team-rank">${medals[i]||i+1}</div>
        <div class="team-info">
          <div class="team-name">${team}</div>
          <div class="team-meta">${getTeamTxnCount(team)} transaction${getTeamTxnCount(team)!==1?'s':''} Â· ${ded>0?`âˆ’${ded} pts deducted`:''}</div>
        </div>
        <div class="team-pts-wrap">
          <div class="team-points">${pts}</div>
          <div class="team-pts-label">Total Points</div>
        </div>
      </div>`;
  }).join('');
}

// ============================================================
//  RENDER PLAYER STATS
// ============================================================

function renderPlayers(data) {
  const el = document.getElementById('players-content');
  if (!data || !data.length) {
    el.innerHTML = `<div class="empty-msg">No player stats yet. Check back after the first tournament!</div>`;
    return;
  }

  const rows = data.filter(r => r['Player'] || r['Player Name']);
  rows.sort((a,b) => (b['Total Points']||0) - (a['Total Points']||0));

  const tableRows = rows.map((row, i) => {
    const name = row['Player'] || row['Player Name'] || '';
    const team = row['Team'] || '';
    const div  = row['Division'] || '';
    const pts  = row['Total Points'] || 0;
    const tc   = TEAM_META[team] || { cls:'rick' };

    let rp = `<span class="rank-pill">${i+1}</span>`;
    if (i===0) rp = `<span class="rank-pill r1">${i+1}</span>`;
    if (i===1) rp = `<span class="rank-pill r2">${i+1}</span>`;
    if (i===2) rp = `<span class="rank-pill r3">${i+1}</span>`;

    return `
      <tr>
        <td class="center">${rp}</td>
        <td><span class="team-dot dot-${tc.cls}"></span>${name}</td>
        <td>${team}</td>
        <td class="center"><span class="div-pill div-${div.toLowerCase()}">${div}</span></td>
        <td class="center" style="font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:1.1rem">${pts}</td>
      </tr>`;
  }).join('');

  el.innerHTML = `
    <table class="data-table">
      <thead><tr>
        <th class="center">Rank</th><th>Player</th><th>Team</th>
        <th class="center">Div</th><th class="center">Points</th>
      </tr></thead>
      <tbody>${tableRows}</tbody>
    </table>`;
}

// ============================================================
//  RENDER RESULTS
// ============================================================

function renderResults(data) {
  const el = document.getElementById('results-content');
  if (!data || !data.length) {
    el.innerHTML = `<div class="empty-msg">No results yet. Check back after the Supreme Flight Open wraps up!</div>`;
    return;
  }

  const byTournament = {};
  data.forEach(row => {
    const t = row['Tournament'];
    if (!t) return;
    if (!byTournament[t]) byTournament[t] = { type: row['Type']||'Regular', mult: row['Multiplier']||'1x', mpo:[], fpo:[] };
    const entry = { place: row['Place'], player: row['Player'], team: row['Team'], pts: row['Final Pts']||row['Base Pts']||0 };
    const div = (row['Division']||'').toUpperCase();
    if (div==='MPO') byTournament[t].mpo.push(entry);
    else if (div==='FPO') byTournament[t].fpo.push(entry);
  });

  el.innerHTML = Object.entries(byTournament).map(([name, t]) => {
    const typeClass = t.type.toLowerCase().includes('major') ? 'major' :
                      t.type.toLowerCase().includes('elite') ? 'eliteplus' : 'regular';

    const makeRows = arr => arr.map(r => {
      const pc  = r.place===1?'p1':r.place===2?'p2':r.place===3?'p3':'';
      const tc  = TEAM_META[r.team];
      const dft = tc && r.team !== 'â€”';
      return `
        <div class="result-row">
          <span class="result-place ${pc}">${r.place}</span>
          <span class="result-player ${dft?'drafted':''}">
            ${dft?`<span class="team-dot dot-${tc.cls}"></span>`:''}${r.player||''}
          </span>
          ${dft&&r.pts?`<span class="result-pts">+${r.pts}</span>`:''}
        </div>`;
    }).join('');

    return `
      <div class="result-card">
        <div class="result-header">
          <div class="result-name">${name}</div>
          <div class="result-meta">
            <span class="type-badge type-${typeClass}">${t.type}</span>
            <span class="mult-tag">${t.mult}</span>
          </div>
        </div>
        <div class="result-body">
          <div class="div-col"><div class="div-label">MPO</div>${t.mpo.length?makeRows(t.mpo):'<span style="color:var(--muted);font-size:.85rem">No data</span>'}</div>
          <div class="div-col"><div class="div-label">FPO</div>${t.fpo.length?makeRows(t.fpo):'<span style="color:var(--muted);font-size:.85rem">No data</span>'}</div>
        </div>
      </div>`;
  }).join('');
}

// ============================================================
//  RENDER ROSTER
// ============================================================

function renderRoster() {
  const el = document.getElementById('roster-content');
  el.innerHTML = Object.entries(ROSTERS).map(([team, players]) => {
    const tc   = TEAM_META[team] || { cls:'rick' };
    const mpo  = players.filter(p => p.division==='MPO');
    const fpo  = players.filter(p => p.division==='FPO');

    return `
      <div class="roster-card">
        <div class="roster-head ${tc.cls}">${team}</div>
        <div class="div-section-label">MPO Players</div>
        ${mpo.map(p=>`<div class="roster-player"><span>${p.name}</span><span class="div-pill div-mpo">MPO</span></div>`).join('')}
        <div class="div-section-label">FPO Players</div>
        ${fpo.map(p=>`<div class="roster-player"><span>${p.name}</span><span class="div-pill div-fpo">FPO</span></div>`).join('')}
      </div>`;
  }).join('');
}

// ============================================================
//  WAIVER WIRE
// ============================================================

function getAllDraftedNames() {
  const names = new Set();
  Object.values(ROSTERS).forEach(team => team.forEach(p => names.add(p.name.toLowerCase())));
  return names;
}

function showWaiverDiv(div, btn) {
  currentWaiverDiv = div;
  document.querySelectorAll('.waiver-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderWaiverTable();
}

function renderWaiver() {
  renderWaiverTable();
  updateTxnPanel();
  renderTxnLog();
}

function renderWaiverTable() {
  const drafted = getAllDraftedNames();
  const rankings = currentWaiverDiv === 'MPO' ? MPO_RANKINGS : FPO_RANKINGS;
  const tbody = document.getElementById('waiver-tbody');

  tbody.innerHTML = rankings.map(p => {
    const isDrafted = drafted.has(p.name.toLowerCase());
    const statusHtml = isDrafted
      ? `<span style="font-size:.75rem;color:var(--muted);background:var(--surface3);padding:2px 8px;border-radius:20px;letter-spacing:.08em">ON ROSTER</span>`
      : `<span style="font-size:.75rem;color:var(--rory);background:#22c55e18;padding:2px 8px;border-radius:20px;border:1px solid #22c55e30;letter-spacing:.08em">AVAILABLE</span>`;

    const actionHtml = isDrafted
      ? `<span style="color:var(--muted);font-size:.8rem">â€”</span>`
      : `<button class="add-btn" onclick="selectAdd('${p.name.replace(/'/g,"\\'")}','${currentWaiverDiv}')">+ Add</button>`;

    return `
      <tr>
        <td class="center"><span class="rank-pill">${p.rank}</span></td>
        <td>${p.name}</td>
        <td class="center">${statusHtml}</td>
        <td class="center">${actionHtml}</td>
      </tr>`;
  }).join('');
}

function selectAdd(playerName, division) {
  pendingAdd = { name: playerName, division: division };
  document.getElementById('txn-add-display').textContent = playerName;
  document.getElementById('txn-add-display').style.color = 'var(--accent)';
  updateTxnPanel();
}

function updateTxnPanel() {
  const team = document.getElementById('txn-team').value;
  const dropSel = document.getElementById('txn-drop');
  const costLabel = document.getElementById('txn-cost-label');
  const costPts = document.getElementById('txn-cost-pts');
  const confirmBtn = document.getElementById('txn-confirm-btn');

  // Populate drop dropdown with same-division players if we have an add selected
  dropSel.innerHTML = '<option value="">â€” Select player to drop â€”</option>';
  if (team && pendingAdd) {
    const teamPlayers = ROSTERS[team] || [];
    const sameDivPlayers = teamPlayers.filter(p => p.division === pendingAdd.division);
    sameDivPlayers.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.name;
      opt.textContent = p.name;
      dropSel.appendChild(opt);
    });
  }

  // Cost
  if (team) {
    const cost = getTransactionCost(team);
    const count = getTeamTxnCount(team);
    costLabel.textContent = `Transaction #${count+1} for ${team}`;
    costPts.textContent = `âˆ’${cost} pts`;
    costPts.style.color = 'var(--joe)';
  } else {
    costLabel.textContent = 'Select team first';
    costPts.textContent = 'â€”';
  }

  // Enable confirm button
  const ready = team && pendingAdd && dropSel.value;
  confirmBtn.disabled = !ready;
}

function openConfirmModal() {
  const team = document.getElementById('txn-team').value;
  const drop = document.getElementById('txn-drop').value;
  const cost = getTransactionCost(team);

  if (!team || !pendingAdd || !drop) return;

  document.getElementById('modal-detail-text').innerHTML = `
    <strong>Team:</strong> ${team}<br>
    <span class="in">+ Adding: ${pendingAdd.name} (${pendingAdd.division})</span><br>
    <span class="out">âˆ’ Dropping: ${drop}</span><br><br>
    <span class="warn">âš  This will deduct ${cost} points from ${team}'s total.</span><br>
    <span style="color:var(--muted);font-size:.82rem">This action is saved and cannot be undone.</span>`;

  document.getElementById('confirm-modal').classList.add('open');
}

function closeModal() {
  document.getElementById('confirm-modal').classList.remove('open');
}

function executeTransaction() {
  const team = document.getElementById('txn-team').value;
  const drop = document.getElementById('txn-drop').value;
  const cost = getTransactionCost(team);

  if (!team || !pendingAdd || !drop) return;

  // Update roster
  ROSTERS[team] = ROSTERS[team].filter(p => p.name !== drop);
  ROSTERS[team].push({ name: pendingAdd.name, division: pendingAdd.division });
  saveRosters();

  // Log transaction
  const log = getTransactionLog();
  log.push({
    team,
    added: pendingAdd.name,
    dropped: drop,
    division: pendingAdd.division,
    cost,
    date: new Date().toLocaleDateString()
  });
  saveTransactionLog(log);

  closeModal();

  // Reset panel
  pendingAdd = null;
  document.getElementById('txn-add-display').textContent = 'Click "Add" next to a player â†’';
  document.getElementById('txn-add-display').style.color = '';
  document.getElementById('txn-team').value = '';
  document.getElementById('txn-drop').innerHTML = '<option value="">â€” Select player to drop â€”</option>';
  document.getElementById('txn-confirm-btn').disabled = true;

  // Re-render
  renderWaiver();
  renderRoster();
  if (SHEET_ID) loadSheetData();

  alert(`âœ… Transaction complete!\n${pendingAdd === null ? team : team} added ${log[log.length-1].added} and dropped ${drop}.\nâˆ’${cost} points deducted.`);
}

function renderTxnLog() {
  const log = getTransactionLog();
  const el = document.getElementById('txn-log-list');
  if (!log.length) {
    el.innerHTML = '<div class="txn-entry" style="color:var(--muted)">No transactions yet.</div>';
    return;
  }
  el.innerHTML = [...log].reverse().map(t => `
    <div class="txn-entry">
      <strong>${t.team}</strong> Â· ${t.date}<br>
      <span class="in">+ ${t.added}</span> / <span class="out">âˆ’ ${t.dropped}</span>
      <span class="cost-tag"> Â· âˆ’${t.cost}pts</span>
    </div>`).join('');
}

// ============================================================
//  INIT
// ============================================================

loadState();
renderRoster();

if (SHEET_ID) {
  document.getElementById('sheet-id-input').value = SHEET_ID;
  loadSheetData();
} else {
  showNoSheet();
}
</script>
</body>
</html>
